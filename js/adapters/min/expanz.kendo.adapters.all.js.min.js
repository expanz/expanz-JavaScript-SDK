function useKendo(){expanz.UIplugin="kendo";renderKendoComponents();useKendoPopups();window.expanz.Views.ContextMenuView.prototype.createContextMenu=function(){this.contextMenuEl.find("ul").kendoMenu({orientation:"vertical"});this.contextMenuEl.show()}}function renderKendoComponents(el){if(el==null){el=$("body")}if(el.find("[renderingType=combobox]").length>0){el.find("[renderingType=combobox]").KendoComboBoxAdapter()}if(el.find("[renderingType=dropdownlist]").length>0){el.find("[renderingType=dropdownlist]").KendoDropDownListAdapter()}if(el.find("[bind=menu] > ul").length>0){el.find("[bind=menu] > ul").kendoMenu()}}function useKendoMobile(){expanz.UIplugin="kendoMobile"}$.fn.KendoComboBoxAdapter=function(){var cb=$(this).kendoComboBox();var list=cb.data("kendoComboBox");var publishData=function(event,xml){var data=new Array();_.each($(xml).find("Row"),function(row){var rowId=$(row).attr("id");_.each($(row).find("Cell"),function(cell){data.push({text:$(cell).html(),value:rowId})})});var ds=new kendo.data.DataSource({data:data});list.dataSource=ds;ds.read();list.refresh();if(cb.val()!=undefined){list.value(cb.val())}};var onValueUpdated=function(event,newValue){list.value(newValue)};cb.bind("valueUpdated",onValueUpdated);cb.bind("publishData",publishData)};$.fn.KendoDropDownListAdapter=function(){var cb=$(this).kendoDropDownList();var list=cb.data("kendoDropDownList");var publishData=function(event,xml){var data=new Array();_.each($(xml).find("Row"),function(row){var rowId=$(row).attr("id");_.each($(row).find("Cell"),function(cell){data.push({text:$(cell).html(),value:rowId})})});var ds=new kendo.data.DataSource({data:data});list.dataSource=ds;ds.read();list.refresh();if(cb.val()!=undefined){list.value(cb.val())}};var onValueUpdated=function(event,newValue){list.value(newValue)};cb.bind("publishData",publishData);cb.bind("valueUpdated",onValueUpdated)};function useKendoPopups(){window.expanz.Views.PopupView.prototype.createWindowObject=function(){this.el.kendoWindow({visible:true,title:this.model.getAttr("title")?this.model.getAttr("title"):"",modal:true,width:this.width})},window.expanz.Views.PopupView.prototype.close=function(){this.el.data("kendoWindow").destroy()},window.expanz.Views.PopupView.prototype.center=function(){this.el.data("kendoWindow").center();this.el.data("kendoWindow").open()}}function createActivityWithKendoTabs(tabElement,ajaxTabContents,callbacks){var tabLoaded=new Array();var nbDynamicTabs=ajaxTabContents.length;var onContentLoad=function(e){var itemName=(e.item.innerText||e.item.textContent);tabLoaded[itemName]=true;if(Object.size(tabLoaded)==nbDynamicTabs){tabLoaded=new Array();expanz.CreateActivity($(e.item).parents("[bind=activity]"),callbacks)}};$(tabElement).kendoTabStrip({contentUrls:ajaxTabContents,contentLoad:onContentLoad});_.each(tabElement.data("kendoTabStrip").tabGroup.children().not("[class*=k-state-active]").not("[class*=k-tab-on-top]"),function(child){tabElement.data("kendoTabStrip").reload($(child))})}$.fn.KendoTreeAdapter=function(options){var treeView=$(this);var parentSelectable=true;var childType="File";var labelAttribute="title";var idAttribute="id";var expandedOnLoad=true;var filteringInput=[];var selectionCallback=null;var onSelection=function(view,id,isChild){if(!parentSelectable&&!isChild){return }view.itemSelected(id,selectionCallback)};if(options){if(options.labelAttribute!=undefined){labelAttribute=options.labelAttribute}if(options.idAttribute!=undefined){idAttribute=options.idAttribute}if(options.selectionCallback!=undefined){selectionCallback=options.selectionCallback}if(options.onSelection!=undefined){onSelection=options.onSelection}if(options.parentSelectable!=undefined){parentSelectable=options.parentSelectable}if(options.expandedOnLoad!=undefined){expandedOnLoad=options.expandedOnLoad}if(options.filteringInput!=undefined){filteringInput=options.filteringInput}}var publishData=function(event,xml,view){window.expanz.logToConsole("KendoTreeAdapter publishData");var xmlData=xml;var data=new Array();var childTag="";if($(xml).find("Rows").length>0){xml=$(xml).find("Rows")}_.each($(xml).children(),function(parentXml){var parentId=$(parentXml).attr(idAttribute);var parentObj=new Object();parentObj.text=$(parentXml).attr(labelAttribute);parentObj.expanded=expandedOnLoad;var items=new Array();_.each($(parentXml).children(),function(childXml){childTag=childXml.tagName;items.push({text:$(childXml).attr(labelAttribute),value:$(childXml).attr(idAttribute)})});if(items.length>0){parentObj.items=items}data.push(parentObj)});treeView.kendoTreeView({dataSource:data});treeView.data("kendoTreeView").bind("select",function(event){var elem=$(xmlData).find("["+labelAttribute+'="'+(event.node.firstChild.textContent||event.node.firstChild.innerText)+'"]');if(onSelection){onSelection(view,elem.attr("id"),elem.is(childTag))}});if(filteringInput&&filteringInput.length>0){var filterInputs=function(event){filterData(event,$(this).val(),data)};var filterButtons=function(event){filterData(event,$(this).attr("filter"),data)};_.each(filteringInput,function(el){if($(el).is("input")){$(el).val("");$(el).bind("change",filterInputs)}else{if($(el).is("button")){$(el).bind("click",filterButtons)}}})}};var filterData=function(event,filter,originalData){var newData;if(filter instanceof Array){filter=str.join("|")}if(filter==null||filter==""){newData=originalData}else{var regExp=new RegExp(filter,"i");var newData=new Array();_.each(originalData,function(subData){var parentObj=new Object();parentObj.text=subData.text;parentObj.expanded=subData.expanded;var items=new Array();_.each(subData.items,function(subItem){if(subItem.text.match(regExp)){items.push(subItem)}});if(items.length>0){parentObj.items=items;newData.push(parentObj)}})}treeView.html("");treeView.removeClass("k-widget k-treeview k-reset");treeView.kendoTreeView({dataSource:newData})};$(this).bind("publishData",publishData);(this).bind("filterData",filterData)};$.fn.KendoMobileListAdapter=function(options){var listView=$(this);var parentSelectable=true;var childType="File";var labelAttribute="title";var idAttribute="id";var selectionCallback=null;var onSelection=function(view,id,isChild){if(!parentSelectable&&!isChild){return }view.itemSelected(id,selectionCallback)};if(options){if(options.labelAttribute!=undefined){labelAttribute=options.labelAttribute}if(options.idAttribute!=undefined){idAttribute=options.idAttribute}if(options.selectionCallback!=undefined){selectionCallback=options.selectionCallback}if(options.onSelection!=undefined){onSelection=options.onSelection}if(options.parentSelectable!=undefined){parentSelectable=options.parentSelectable}}var publishData=function(event,xml,view){window.expanz.logToConsole("KendoMobileListAdapter publishData");var xmlData=xml;var data=new Array();var childTag="";if($(xml).find("Rows").length>0){xml=$(xml).find("Rows")}_.each($(xml).children(),function(parentXml){var items=new Array();_.each($(parentXml).children(),function(childXml){data.push({name:$(childXml).attr(labelAttribute),category:$(parentXml).attr(labelAttribute),id:$(childXml).attr(idAttribute)})})});listView.kendoMobileListView({dataSource:kendo.data.DataSource.create({data:data,group:"category"}),template:"${name}",click:function(e){window.expanz.logToConsole(e.dataItem.id)}})};$(this).bind("publishData",publishData)};