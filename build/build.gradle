// Pull the plugin from a Maven Repo
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.eriwen:gradle-js-plugin:0.3'
    }
}
// Invoke the plugin
apply plugin: 'js'

jsDir = "../expanz-JavaScript-SDK/js/"
env = System.getenv()
jsVersion = "" //${env.BUILD_NUMBER}.

// Specify a collection of files to be combined, then minified and finally GZip compressed.
combineJs  {
	dependsOn << 'clean'
    file1 = fileTree(dir: "${jsDir}", includes: ['jquery-1.7.1.js'])
	file2 = fileTree(dir: "${jsDir}", includes: ['jquery.cookies.2.2.0.js'])
	file3 = fileTree(dir: "${jsDir}", includes: ['jquery-ui-1.8.16.custom.min.js'])
	file4 = fileTree(dir: "${jsDir}", includes: ['jquery.i18n.properties-min-1.0.9.js'])
	file5 = fileTree(dir: "${jsDir}", includes: ['json2.js'])
	file6 = fileTree(dir: "${jsDir}", includes: ['modernizr-2.0.6.js'])
	file7 = fileTree(dir: "${jsDir}", includes: ['underscore-min.js'])
	file8 = fileTree(dir: "${jsDir}", includes: ['backbone-min.js'])
	file9 = fileTree(dir: "${jsDir}", includes: ['expanz.util.js'])
	file10 = fileTree(dir: "${jsDir}", includes: ['expanz.factory.js'])
	file11 = fileTree(dir: "${jsDir}", includes: ['expanz.model.js'])
	file12 = fileTree(dir: "${jsDir}", includes: ['expanz.net.js'])
	file13 = fileTree(dir: "${jsDir}", includes: ['expanz.storage.js'])
	file14 = fileTree(dir: "${jsDir}", includes: ['expanz.model.data.js'])
	file15 = fileTree(dir: "${jsDir}", includes: ['expanz.view.js'])
	file16 = fileTree(dir: "${jsDir}", includes: ['expanz.js'])

    inputs.files file1 + file2 + file3 + file4 + file5 + file6 + file7 + file8 + file9 + file10 + file11 + file12 + file13 + file14 + file15 + file16
    outputs.file file("${jsDir}/min/expanz.sdk.${jsVersion}js")
}

// Specify a collection of files to be combined, then minified and finally GZip compressed.
minifyJs  {
	dependsOn << 'combineJs'
    file1 = fileTree(dir: "${jsDir}/min/", includes: ["expanz.sdk.${jsVersion}js"])
    inputs.files file1 
    outputs.file file("${jsDir}/min/expanz.sdk.${jsVersion}min.js")
}

// Specify a collection of files to be combined, then minified and finally GZip compressed.
gzipJs  {
	dependsOn << 'minifyJs'
    file1 = fileTree(dir: "${jsDir}/min/", includes: ["expanz.sdk.${jsVersion}min.js"])
    inputs.files file1 
    outputs.file file("${jsDir}/min/expanz.sdk.${jsVersion}min.gzip.js")
}

task clean {
	println 'Cleaning files'
	doLast {
		ant.delete(dir: "${jsDir}/min/")
	}
}

task minify (dependsOn: ['gzipJs'] ){ 
	println "Starting minifying version ${env.BUILD_NUMBER}"
}




