function useKendo(){expanz.UIplugin="kendo";renderKendoComponents();useKendoPopups();window.expanz.Views.ContextMenuView.prototype.createContextMenu=function(){this.contextMenuEl.find("ul").kendoMenu({orientation:"vertical"});this.contextMenuEl.show()}}
function renderKendoComponents(el){if(el===undefined)el=$("body");if(el.find("[renderingType=combobox]").length>0)el.find("[renderingType=combobox]").KendoComboBoxAdapter();if(el.find("[renderingType=dropdownlist]").length>0)el.find("[renderingType=dropdownlist]").KendoDropDownListAdapter();if(el.find("[bind=menu] > ul.menu").length>0)el.find("[bind=menu] > ul.menu").kendoMenu();if(el.find("[renderingType=numerictextbox]").length>0)el.find("[renderingType=numerictextbox]").kendoNumericTextBox({min:1,
max:99,step:1,format:"n0"})}function useKendoMobile(){expanz.UIplugin="kendoMobile"}
$.fn.KendoComboBoxAdapter=function(){var cb=$(this).kendoComboBox({dataTextField:"text",dataValueField:"value"});var list=cb.data("kendoComboBox");var publishData=function(event,xml){var data=[];_.each($(xml).find("Row"),function(row){var rowId=$(row).attr("id");_.each($(row).find("Cell"),function(cell){data.push({text:$(cell).text(),value:rowId==0?$(cell).text():rowId})})});var ds=new kendo.data.DataSource({data:data});list.dataSource=ds;ds.read();list.refresh();if(cb.val()!==undefined)list.value(cb.val())};
var onValueUpdated=function(event,newValue){list.value(newValue)};cb.bind("valueUpdated",onValueUpdated);cb.bind("publishData",publishData)};
$.fn.KendoDropDownListAdapter=function(){var cb=$(this).kendoDropDownList({dataTextField:"text",dataValueField:"value"});var list=cb.data("kendoDropDownList");var emptyItemLabel=null;if($(this).attr("emptyItemLabel")!==undefined)emptyItemLabel=$(this).attr("emptyItemLabel");var publishData=function(event,xml){var data=[];if(emptyItemLabel!=null)data.push({text:emptyItemLabel,value:""});_.each($(xml).find("Row"),function(row){var rowId=$(row).attr("id");_.each($(row).find("Cell"),function(cell){data.push({text:$(cell).text(),
value:rowId==0?$(cell).text():rowId})})});var ds=new kendo.data.DataSource({data:data});list.dataSource=ds;ds.read();list.refresh();if(cb.val()!==undefined)list.value(cb.val())};var onValueUpdated=function(event,newValue){list.value(newValue)};cb.bind("publishData",publishData);cb.bind("valueUpdated",onValueUpdated)};
$.fn.KendoMobileListAdapter=function(options){var listView=$(this);var parentSelectable=true;var labelAttribute="title";var idAttribute="id";var selectionCallback=null;var onSelection=function(view,id,isChild){if(!parentSelectable&&!isChild)return;view.itemSelected(id,selectionCallback)};if(options){if(options["labelAttribute"]!=undefined)labelAttribute=options["labelAttribute"];if(options["idAttribute"]!=undefined)idAttribute=options["idAttribute"];if(options["selectionCallback"]!=undefined)selectionCallback=
options["selectionCallback"];if(options["onSelection"]!=undefined)onSelection=options["onSelection"];if(options["parentSelectable"]!=undefined)parentSelectable=options["parentSelectable"]}var publishData=function(event,xml,view){window.expanz.logToConsole("KendoMobileListAdapter publishData");var xmlData=xml;var data=new Array;var childTag="";if($(xml).find("Rows").length>0)xml=$(xml).find("Rows");_.each($(xml).children(),function(parentXml){var items=new Array;_.each($(parentXml).children(),function(childXml){data.push({name:$(childXml).attr(labelAttribute),
category:$(parentXml).attr(labelAttribute),id:$(childXml).attr(idAttribute)})})});listView.kendoMobileListView({dataSource:kendo.data.DataSource.create({data:data,group:"category"}),template:"${name}",click:function(e){window.expanz.logToConsole(e.dataItem.id)}})};$(this).bind("publishData",publishData)};
$.fn.KendoPanelBarAdapter=function(options){var panelView=$(this);var parentSelectable=true;var labelAttribute="title";var idAttribute="id";var expandedOnLoad=true;var staticElements={};var selectionCallback=null;var runAfterPublish=null;var onSelection=function(view,id,isChild){if(!parentSelectable&&!isChild)return;view.itemSelected(id,selectionCallback)};if(options){if(options["labelAttribute"]!==undefined)labelAttribute=options["labelAttribute"];if(options["idAttribute"]!==undefined)idAttribute=
options["idAttribute"];if(options["selectionCallback"]!==undefined)selectionCallback=options["selectionCallback"];if(options["onSelection"]!==undefined)onSelection=options["onSelection"];if(options["parentSelectable"]!==undefined)parentSelectable=options["parentSelectable"];if(options["expandedOnLoad"]!==undefined)expandedOnLoad=options["expandedOnLoad"];if(options["runAfterPublish"]!==undefined)runAfterPublish=options["runAfterPublish"];if(options["staticElements"]!==undefined)staticElements=options["staticElements"]}var publishData=
function(event,xml,view){window.expanz.logToConsole("KendoPanelBarAdapter publishData");var xmlData=xml;var data=[];var childTag="";if($(xml).find("Rows").length>0)xml=$(xml).find("Rows");_.each($(xml).children(),function(parentXml){var parentId=$(parentXml).attr(idAttribute);var parentObj={};parentObj.text=$(parentXml).attr(labelAttribute);parentObj.expanded=expandedOnLoad;parentObj.allAttributes=$(parentXml).getAttributes();var items=[];_.each($(parentXml).children(),function(childXml){childTag=
childXml.tagName;items.push({text:$(childXml).attr(labelAttribute),value:$(childXml).attr(idAttribute),allAttributes:$(childXml)})});if(items.length>0){items.sort(getObjectSortAscendingFunction("text"));parentObj.items=items}data.push(parentObj)});data.sort(getObjectSortAscendingFunction("text"));_.each(staticElements,function(elem){if(elem.position!=undefined&&elem.position=="end")data.push({text:$(elem).attr("label")});else data.unshift({text:$(elem).attr("label")})});panelView.kendoPanelBar({dataSource:data});
panelView.children("li").addClass("level1");panelView.children("li").find("ul").children("li").addClass("level2");panelView.data("kendoPanelBar").bind("select",function(event){var selectedText=event.item.firstChild.textContent||event.item.firstChild.innerText;var isStatic=false;if(staticElements.length>0)_.each(staticElements,function(elem){if(selectedText===elem.label){isStatic=true;expanz.Net.MethodRequest(elem.method,[{name:"contextObject",value:elem.contextObject}],null,view.model.getAttr("parent"))}});
if(!isStatic){var elem=undefined;$(xmlData).find("["+labelAttribute+"]").each(function(){if(selectedText===$(this).attr(labelAttribute))elem=$(this)});if(onSelection)onSelection(view,elem.attr("id"),elem.is(childTag))}});if(runAfterPublish)runAfterPublish(xmlData);$(this).trigger("dataPublished")};$(this).bind("publishData",publishData)};
function useKendoPopups(){window.expanz.Views.PopupView.prototype.createWindowObject=function(){var title=this.model.getAttr("title");var that=this;this.el.kendoWindow({visible:true,title:this.model.getAttr("title")?this.model.getAttr("title"):"",modal:true,width:this.width,close:function(){that.trigger("popupClosed");if(that.postCloseActions)that.postCloseActions(title)}});var thatEl=this.el;this.el.data("kendoWindow").bind("open",function(){$(thatEl).parent().find(".k-window-title").html($(thatEl).parent().find(".k-window-title").text())})};
window.expanz.Views.PopupView.prototype.close=function(){if(this.el.data("kendoWindow"))this.el.data("kendoWindow").destroy()};window.expanz.Views.PopupView.prototype.center=function(){this.el.data("kendoWindow").center();this.el.data("kendoWindow").open()}}
function createActivityWithKendoTabs(tabElement,ajaxTabContents,callbacks){var tabLoaded=[];var nbDynamicTabs=ajaxTabContents.length;for(var i=0;i<nbDynamicTabs;i++)ajaxTabContents[i]=getPageUrl(ajaxTabContents[i]);var onContentLoad=function(e){var itemName=e.item.innerText||e.item.textContent;tabLoaded[itemName]=true;if(Object.size(tabLoaded)==nbDynamicTabs){addPlaceHolderCapabilities();tabLoaded=[];expanz.CreateActivity($(e.item).parents("[bind=activity]"),callbacks)}};$(tabElement).kendoTabStrip({contentUrls:ajaxTabContents,
contentLoad:onContentLoad});_.each(tabElement.data("kendoTabStrip").tabGroup.children().not("[class*=k-state-active]").not("[class*=k-tab-on-top]"),function(child){tabElement.data("kendoTabStrip").reload($(child))})}
$.fn.KendoTreeAdapter=function(options){var treeView=$(this);var parentSelectable=true;var labelAttribute="title";var idAttribute="id";var expandedOnLoad=true;var filteringInput=[];var displayLoading=true;var staticElements={};var selectionCallback=null;var callback={success:function(){if(displayLoading){treeView.removeClass("treeSelectionLoading");var loadingId="LoadingTree_"+treeView.attr("id");var loadingEL=$(treeView).find("#"+loadingId);if(loadingEL)loadingEL.hide()}if(selectionCallback)selectionCallback.call()}};
var runAfterPublish=null;var onSelection=function(view,id,isChild){if(!parentSelectable&&!isChild)return;view.itemSelected(id,callback);if(displayLoading){var loadingId="LoadingTree_"+treeView.attr("id");var loadingEL=$(view.el).find("#"+loadingId);if(loadingEL.length===0){$(view.el).append('<div class="loading" id="'+loadingId+'"><span> </span></div>');loadingEL=$(view.el).find("#"+loadingId)}loadingEL.css("position","absolute");loadingEL.css("width","100%");loadingEL.css("height","100%");loadingEL.css("margin",
"0");loadingEL.css("padding","0");loadingEL.css("top","0px");loadingEL.css("left","0px");loadingEL.css("z-index","999");loadingEL.css("overflow","hidden");loadingEL.css("background","url(data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==) center");loadingEL.show();treeView.addClass("treeSelectionLoading")}};var filterData=function(event,filter,originalData){var newData;if(filter instanceof Array)filter=str.join("|");if(filter===null||filter==="")newData=originalData;
else{var regExp=new RegExp(filter,"i");var newData=[];_.each(originalData,function(subData){var parentObj={};parentObj.text=subData.text;parentObj.expanded=subData.expanded;var items=[];_.each(subData.items,function(subItem){if(subItem.text.match(regExp))items.push(subItem)});if(items.length>0){parentObj.items=items;newData.push(parentObj)}})}treeView.html("");treeView.removeClass("k-widget k-treeview k-reset");treeView.kendoTreeView({dataSource:newData})};if(options){if(options["labelAttribute"]!==
undefined)labelAttribute=options["labelAttribute"];if(options["idAttribute"]!==undefined)idAttribute=options["idAttribute"];if(options["selectionCallback"]!==undefined)selectionCallback=options["selectionCallback"];if(options["onSelection"]!==undefined)onSelection=options["onSelection"];if(options["parentSelectable"]!==undefined)parentSelectable=options["parentSelectable"];if(options["expandedOnLoad"]!==undefined)expandedOnLoad=options["expandedOnLoad"];if(options["filteringInput"]!==undefined)filteringInput=
options["filteringInput"];if(options["runAfterPublish"]!==undefined)runAfterPublish=options["runAfterPublish"];if(options["filterData"]!==undefined)filterData=options["filterData"];if(options["displayLoading"]!==undefined)displayLoading=options["displayLoading"];if(options["staticElements"]!==undefined)staticElements=options["staticElements"]}var parseChildrenRows=function(parentXml){var items=[];_.each($(parentXml).children(),function(childXml){var child={text:$(childXml).attr(labelAttribute),value:$(childXml).attr(idAttribute),
allAttributes:$(childXml),expanded:expandedOnLoad};if($(childXml).attr("Type")=="parent"){var itemsChildren=parseChildrenRows(childXml);if(itemsChildren.length>0)child.items=itemsChildren}items.push(child)});return items};var parseRow=function(parentXml){var parentId=$(parentXml).attr(idAttribute);var parentObj={};parentObj.text=$(parentXml).attr(labelAttribute);parentObj.expanded=expandedOnLoad;parentObj.allAttributes=$(parentXml).getAttributes();var items=parseChildrenRows(parentXml);if(items.length>
0)parentObj.items=items;return parentObj};var publishData=function(event,xml,view){window.expanz.logToConsole("KendoTreeAdapter publishData");var xmlData=xml;var data=[];var parentTag="";if($(xml).find("Rows").length>0)xml=$(xml).find("Rows");_.each($(xml).children(),function(parentXml){var parentObj=parseRow(parentXml);parentTag=parentXml.tagName;data.push(parentObj)});_.each(staticElements,function(elem){if(elem.position!=undefined&&elem.position=="end")data.push({text:$(elem).attr("label")});else data.unshift({text:$(elem).attr("label")})});
treeView.kendoTreeView({dataSource:data});treeView.data("kendoTreeView").bind("select",function(event){var selectedText=event.node.firstChild.textContent||event.node.firstChild.innerText;var isStatic=false;if(staticElements.length>0)_.each(staticElements,function(elem){if(selectedText===elem.label){isStatic=true;expanz.Net.MethodRequest(elem.method,[{name:"contextObject",value:elem.contextObject}],null,view.model.getAttr("parent"));$(treeView).trigger("TreeSelectionChanged",{id:"static",text:selectedText})}});
if(!isStatic){var elem=undefined;$(xmlData).find("["+labelAttribute+"]").each(function(){if(selectedText===$(this).attr(labelAttribute))elem=$(this)});if(onSelection)onSelection(view,elem.attr("id"),!elem.is(parentTag));$(treeView).trigger("TreeSelectionChanged",{id:elem.attr("id"),text:selectedText,parentId:elem.parent().attr("id"),parentText:elem.parent().attr(labelAttribute)})}});if(filteringInput&&filteringInput.length>0){var filterInputs=function(event){filterData(event,$(this).val(),data)};
var filterButtons=function(event){filterData(event,$(this).attr("filter"),data)};_.each(filteringInput,function(el){if($(el).is("input")){$(el).val("");$(el).bind("change",filterInputs)}else if($(el).is("button"))$(el).bind("click",filterButtons)})}if(runAfterPublish)runAfterPublish(xmlData)};$(this).bind("publishData",publishData);$(this).bind("filterData",filterData)};